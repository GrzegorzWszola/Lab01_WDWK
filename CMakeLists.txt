cmake_minimum_required(VERSION 3.10)
project(AssemblerApp VERSION 1.0 LANGUAGES C)

set(ASM_SOURCE ${CMAKE_CURRENT_SOURCE_DIR}/src/LabWDWK.asm)
set(EXECUTABLE_NAME Lab01)
set(ASM_FLAGS "--32") 
set(LINKER_FLAGS "-m32") 
set(CMAKE_ASM_COMPILER as)
set(OBJ_FILE ${CMAKE_BINARY_DIR}/LabWDWK.o)
set(EXEC_FILE ${CMAKE_BINARY_DIR}/${EXECUTABLE_NAME})

message(STATUS "ASM source file: ${ASM_SOURCE}")

add_custom_command(
    OUTPUT ${EXEC_FILE}
    COMMAND ${CMAKE_ASM_COMPILER} ${ASM_FLAGS} -o ${OBJ_FILE} ${ASM_SOURCE}  
    COMMAND gcc ${LINKER_FLAGS} -o ${EXEC_FILE} ${OBJ_FILE}  
    DEPENDS ${ASM_SOURCE}  
)
add_custom_target(run ALL DEPENDS ${EXEC_FILE})

